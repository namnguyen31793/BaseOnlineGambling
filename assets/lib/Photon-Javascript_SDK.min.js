var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,o){e!=Array.prototype&&e!=Object.prototype&&(e[t]=o.value)},$jscomp.getGlobal=function(e){return("undefined"==typeof window||window!==e)&&"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,o,r){if(t){for(o=$jscomp.global,e=e.split("."),r=0;r<e.length-1;r++){var n=e[r];n in o||(o[n]={}),o=o[n]}(t=t(r=o[e=e[e.length-1]]))!=r&&null!=t&&$jscomp.defineProperty(o,e,{configurable:!0,writable:!0,value:t})}},$jscomp.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.polyfill("Object.setPrototypeOf",function(e){return e||$jscomp.setPrototypeOf},"es6","es5");var Exitgames,Photon,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();!function(e){function n(e,t){void 0===e&&(e=""),void 0===t&&(t=n.Level.INFO),this.prefix=e,this.level=t}function t(){}var o;o=e.Common||(e.Common={}),n.prototype.setPrefix=function(e){this.prefix=e},n.prototype.getPrefix=function(){return this.prefix},n.prototype.setLevel=function(e){e=Math.max(e,n.Level.DEBUG),this.level=e=Math.min(e,n.Level.OFF)},n.setExceptionHandler=function(e){this.exceptionHandler=e},n.prototype.isLevelEnabled=function(e){return e>=this.level},n.prototype.getLevel=function(){return this.level},n.prototype.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(n.Level.DEBUG,e,t)},n.prototype.info=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(n.Level.INFO,e,t)},n.prototype.warn=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(n.Level.WARN,e,t)},n.prototype.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.log(n.Level.ERROR,e,t)},n.prototype.exception=function(e,t){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];if(!n.exceptionHandler||!n.exceptionHandler(e,this.format0(t,o)))throw Error(this.format0("["+e+"] "+t,o))},n.prototype.format=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return this.format0(e,t)},n.prototype.formatArr=function(e,t){return this.format0(e,t)},n.prototype.log=function(e,t,o){if(e>=this.level&&"undefined"!=typeof console&&void 0!==t)try{var r=console[n.log_types[e]];(r=r||console.log)&&r.apply(console,[this.prefix,t].concat(o))}catch(e){}},n.prototype.format0=function(e,t){return(""==this.prefix?"":this.prefix+" ")+e+" "+t.map(function(t){if(void 0!==t){if("object"==typeof t)try{return JSON.stringify(t)}catch(e){return t.toString()+"("+e+")"}return t.toString()}}).join(" ")},n.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,OFF:6},n.log_types=["debug","debug","info","warn","error"],e=n,o.Logger=e,t.indexOf=function(e,t,o){var r=e.length;for(o=o<0?Math.max(0,r+o):o||0;o<r;o++)if(e[o]===t)return o;return-1},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.merge=function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},t.getPropertyOrElse=function(e,t,o){return e.hasOwnProperty(t)?e[t]:o},t.enumValueToName=function(e,t){for(var o in e)if(t==e[o])return o;return"undefined"},t.getEnumKeyByValue=function(e,t){for(var o in e)if(t==e[o])return o},e=t,o.Util=e}(Exitgames=Exitgames||{}),function(e){var n;(t=n=e.ConnectionProtocol||(e.ConnectionProtocol={}))[t.Ws=0]="Ws",t[t.Wss=1]="Wss";var t=function(){};function o(){}function r(e,t,o,r){void 0===o&&(o=""),void 0===r&&(r=""),this.protocol=e,this.address=t,this.subprotocol=o,this.keepAliveTimeoutMs=3e3,this._frame="~m~",this._isClosing=this._isConnected=this._isConnecting=!1,this._peerStatusListeners={},this._eventListeners={},this._responseListeners={},this.lastRtt=0,this.initTimestamp=Date.now(),this.keepAliveTimer=0,this.url=this.addProtocolPrefix(this.address,this.protocol),this._logger=new Exitgames.Common.Logger(r&&""!=r?r+":":"")}e.TypeExtType=t,o.Is=function(e){return!1},o.Byte=function(e){return e},o.Short=function(e){return e},o.Int=function(e){return e},o.Long=function(e){return e},o.Float=function(e){return e},o.Double=function(e){return e},o.String=function(e){return e},o.Bool=function(e){return e},o.Dict=function(e,t,o){return o},t=o,e.TypeExt=t,r.prototype.addProtocolPrefix=function(e,t){var o,r={ws:"ws://",wss:"wss://"};for(o in r)if(0==e.indexOf(r[o]))return e;switch(t){case n.Ws:return r.ws+e;case n.Wss:return r.wss+e;default:return r.ws+e}},r.prototype.Destroy=function(){},r.prototype.isConnecting=function(){return this._isConnecting},r.prototype.getLastRtt=function(){return this.lastRtt},r.prototype.isConnected=function(){return this._isConnected},r.prototype.isClosing=function(){return this._isClosing},r.prototype.connect=function(e){var t=this;this._sessionid=void 0,e=this.url+"/"+e+"?libversion=4.1.0.0",this._socket=""==this.subprotocol?new WebSocket(e,"Json",Global.CApem):new WebSocket(e,this.subprotocol,Global.CApem),this._onConnecting(),this._socket.onopen=function(e){},this._socket.onmessage=function(e){e=t._decode(e.data),t._onMessage(e.toString())},this._socket.onclose=function(e){t._logger.debug("onclose: wasClean =",e.wasClean,", code=",e.code,", reason =",e.reason),t._isConnecting?t._onConnectFailed(e):(1006==e.code&&t._onTimeout(),t._onDisconnect())},this._socket.onerror=function(e){cc.log("Connect Error: "+e),t._onError(e)}},r.prototype.disconnect=function(){this._isClosing=!0,this._socket.close()},r.prototype.sendOperation=function(e,t,o,r){e={req:e,vals:[]},Exitgames.Common.Util.isArray(t)?e.vals=t:void 0===t?e.vals=[]:this._logger.exception(201,"PhotonPeer[sendOperation] - Trying to send non array data:",t),this._send(e),this._logger.debug("PhotonPeer[sendOperation] - Sending request:",e)},r.prototype.addPeerStatusListener=function(e,t){this._addListener(this._peerStatusListeners,e,t)},r.prototype.addEventListener=function(e,t){this._addListener(this._eventListeners,e.toString(),t)},r.prototype.addResponseListener=function(e,t){this._addListener(this._responseListeners,e.toString(),t)},r.prototype.removePeerStatusListener=function(e,t){this._removeListener(this._peerStatusListeners,e,t)},r.prototype.removeEventListener=function(e,t){this._removeListener(this._eventListeners,e.toString(),t)},r.prototype.removeResponseListener=function(e,t){this._removeListener(this._responseListeners,e.toString(),t)},r.prototype.removePeerStatusListenersForCode=function(e){this._removeListenersForCode(this._peerStatusListeners,e)},r.prototype.removeEventListenersForCode=function(e){this._removeListenersForCode(this._eventListeners,e.toString())},r.prototype.removeResponseListenersForCode=function(e){this._removeListenersForCode(this._responseListeners,e.toString())},r.prototype.setLogLevel=function(e){this._logger.setLevel(e)},r.prototype.onUnhandledEvent=function(e,t){this._logger.warn("PhotonPeer: No handler for event",e,"registered.")},r.prototype.onUnhandledResponse=function(e,t){this._logger.warn("PhotonPeer: No handler for response",e,"registered.")},r.prototype._dispatchEvent=function(e,t){this._dispatch(this._eventListeners,e.toString(),t,"event")||this.onUnhandledEvent(e,t)},r.prototype._dispatchResponse=function(e,t){this._dispatch(this._responseListeners,e.toString(),t,"response")||this.onUnhandledResponse(e,t)},r.prototype._stringify=function(e){return"[object Object]"==Object.prototype.toString.call(e)?(JSON||this._logger.exception(202,"PhotonPeer[_stringify] - Trying to encode as JSON, but JSON.stringify is missing."),"~j~"+JSON.stringify(e)):String(e)},r.prototype._encode=function(e){for(var t="",o=0,r=(e=Exitgames.Common.Util.isArray(e)?e:[e]).length;o<r;o++){var n=null===e[o]||void 0===e[o]?"":this._stringify(e[o]);t+=this._frame+n.length+this._frame+n}return t},r.prototype._decode=function(e){var t=[],o=e;-1!==e.indexOf("\0")&&(o=e.replace(/[\0]/g,"")),e=o;do{if(e.substr(0,3)!==this._frame)break;o="";for(var r=0,n=(e=e.substr(3)).length;r<n;r++){var s=Number(e.substr(r,1));if(e.substr(r,1)!=s){e=e.substr(o.length+this._frame.length),o=Number(o);break}o+=s}}while(t.push(e.substr(0,o)),""!==(e=e.substr(o)));return t},r.prototype._onMessage=function(e){"~j~"==e.substr(0,3)?this._onMessageReceived(JSON.parse(e.substr(3))):this._sessionid?this._onMessageReceived(e):(this._sessionid=e,this._onConnect())},r.prototype.resetKeepAlive=function(){var t=this;clearTimeout(this.keepAliveTimer),1e3<=this.keepAliveTimeoutMs&&(this.keepAliveTimer=setTimeout(function(){var e;t._send(((e={}).irq=1,e.vals=[1,Date.now()-t.initTimestamp],e),!0)},this.keepAliveTimeoutMs))},r.prototype._send=function(e,t){void 0===t&&(t=!1);var o=this._encode(e);this._isConnected&&!this._isClosing?(this.resetKeepAlive(),this._socket.send(o)):t||this._logger.exception(203,"PhotonPeer[_send] - Operation",e.req,'- failed, "isConnected" is',this._isConnected,', "isClosing" is',this._isClosing,"!")},r.prototype._onMessageReceived=function(e){var t;"object"==typeof e&&(this._logger.debug("PhotonPeer[_onMessageReceived] - Socket received message:",e),(e={err:e.err,msg:e.msg,vals:e.vals,res:e.res,evt:e.evt,irs:e.irs}).vals=void 0!==e.vals?e.vals:[],0<e.vals.length&&(e.vals=this._parseMessageValuesArrayToJSON(e.vals)),void 0!==e.res?(t=parseInt(e.res),this._parseResponse(t,e)):void 0!==e.evt?(t=parseInt(e.evt),this._parseEvent(t,e)):void 0!==e.irs?(t=parseInt(e.irs),this._parseInternalResponse(t,e)):this._logger.exception(204,"PhotonPeer[_onMessageReceived] - Received undefined message type:",e))},r.prototype._parseMessageValuesArrayToJSON=function(e){var t,o,r={};if(Exitgames.Common.Util.isArray(e))if(0==e.length%2)for(;0<e.length;)t=e.shift()+"",o=e.shift(),r[t]=o;else this._logger.exception(205,"PhotonPeer[_parseMessageValuesToJSON] - Received invalid values array:",e);return r},r.prototype._parseEvent=function(e,t){this._dispatchEvent(e,{vals:t.vals})},r.prototype._parseResponse=function(e,t){this._dispatchResponse(e,{errCode:t.err,errMsg:t.msg,vals:t.vals})},r.prototype._parseInternalResponse=function(e,t){this.lastRtt=Date.now()-this.initTimestamp-t.vals[1],this._logger.debug("internal response:",t)},r.prototype._onConnecting=function(){this._logger.debug("PhotonPeer[_onConnecting] - Starts connecting",this.url,'..., raising "connecting" event ...'),this._isConnecting=!0,this._dispatchPeerStatus(r.StatusCodes.connecting),this.resetKeepAlive()},r.prototype._onConnect=function(){this._logger.debug('PhotonPeer[_onConnect] - Connected successfully! Raising "connect" event ...'),this._isConnecting=!1,this._isConnected=!0,this._dispatchPeerStatus(r.StatusCodes.connect),this.resetKeepAlive()},r.prototype._onConnectFailed=function(e){this._logger.error("PhotonPeer[_onConnectFailed] - Socket connection could not be created:",this.url,this.subprotocol,'Wrong host or port?\n Raising "connectFailed event ...'),this._isConnecting=this._isConnected=!1,this._dispatchPeerStatus(r.StatusCodes.connectFailed)},r.prototype._onDisconnect=function(){var e=this._isConnected,t=this._isClosing;this._logger.debug('PhotonPeer[_onDisconnect] - Socket closed, raising "disconnect" event ...'),this._isClosing=this._isConnected=this._isConnecting=!1,e&&(t?this._dispatchPeerStatus(r.StatusCodes.disconnect):this._dispatchPeerStatus(r.StatusCodes.connectClosed))},r.prototype._onTimeout=function(){this._logger.debug('PhotonPeer[_onTimeout] - Client timed out! Raising "timeout" event ...'),this._dispatchPeerStatus(r.StatusCodes.timeout)},r.prototype._onError=function(e){this._logger.error("PhotonPeer[_onError] - Connection error:",e),this._isConnecting=this._isConnected=this._isClosing=!1,this._dispatchPeerStatus(r.StatusCodes.error)},r.prototype._addListener=function(e,t,o){return t in e||(e[t]=[]),o&&"function"==typeof o?(this._logger.debug("PhotonPeer[_addListener] - Adding listener for event",t),e[t].push(o)):this._logger.error("PhotonPeer[_addListener] - Listener",t,"is not a function but of type",typeof o,". No listener added!"),this},r.prototype._dispatch=function(e,t,o,r){if(t in e){for(e=e[t],t=0,r=e.length;t<r;t++)Exitgames.Common.Util.isArray(o)||(o=[o]),e[t].apply(this,void 0===o?[]:o);return!0}return!1},r.prototype._dispatchPeerStatus=function(e){this._dispatch(this._peerStatusListeners,e,void 0,"peerStatus")||this._logger.warn("PhotonPeer[_dispatchPeerStatus] - No handler for ",e,"registered.")},r.prototype._removeListener=function(e,t,o){var r;return t in e&&(r=e[t].length,e[t]=e[t].filter(function(e){return e!=o}),this._logger.debug("PhotonPeer[_removeListener] - Removing listener for event",t,"removed:",r-e[t].length)),this},r.prototype._removeListenersForCode=function(e,t){return this._logger.debug("PhotonPeer[_removeListenersForCode] - Removing all listeners for event",t),t in e&&(e[t]=[]),this},r.StatusCodes={connecting:"connecting",connect:"connect",connectFailed:"connectFailed",disconnect:"disconnect",connectClosed:"connectClosed",error:"error",timeout:"timeout"},t=r,e.PhotonPeer=t}(Photon=Photon||{}),function(b){!function(c){var r=(e.prototype.getRoom=function(){return this.loadBalancingClient.myRoom()},e.prototype.raiseEvent=function(e,t,o){this.loadBalancingClient&&this.loadBalancingClient.raiseEvent(e,t,o)},e.prototype.setName=function(e){this.name=e},e.prototype.onPropertiesChange=function(e,t){},e.prototype.getCustomProperty=function(e){return this.customProperties[e]},e.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this.customProperties,e,t)},e.prototype.setCustomProperty=function(e,t,o,r){void 0===o&&(o=!1),this.customProperties[e]=t;var n,s={};s[e]=t,null!=r&&((n={})[e]=r,n=n),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,s,o,n),this.onPropertiesChange(s,!0)},e.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var r,n={};for(r in e)this.customProperties[r]=e[r],n[r]=e[r];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,n,t,o),this.onPropertiesChange(n,!0)},e.prototype.isSuspended=function(){return this.suspended},e.prototype._getAllProperties=function(){var e,t={};for(e in t[c.Constants.ActorProperties.PlayerName]=this.name,this.customProperties)t[e]=this.customProperties[e];return t},e.prototype._setLBC=function(e){this.loadBalancingClient=e},e.prototype._updateFromResponse=function(e){var t;this.actorNr=e[c.Constants.ParameterCode.ActorNr],void 0!==(e=e[c.Constants.ParameterCode.PlayerProperties])&&(void 0!==(t=e[c.Constants.ActorProperties.PlayerName])&&(this.name=t),this._updateCustomProperties(e))},e.prototype._updateMyActorFromResponse=function(e){this.actorNr=e[c.Constants.ParameterCode.ActorNr]},e.prototype._updateCustomProperties=function(e){for(var t in e)this.customProperties[t]=e[t];this.onPropertiesChange(e,!1)},e.prototype._setSuspended=function(e){this.suspended=e},e._getActorNrFromResponse=function(e){return e[c.Constants.ParameterCode.ActorNr]},e);function e(e,t,o){this.name=e,this.actorNr=t,this.isLocal=o,this.customProperties={},this.suspended=!1}c.Actor=r;var i=(t.prototype.onPropertiesChange=function(e,t){},t.prototype.getCustomProperty=function(e){return this._customProperties[e]},t.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this._customProperties,e,t)},t.prototype._updateFromMasterResponse=function(e){this.address=e[c.Constants.ParameterCode.Address],(e=e[c.Constants.ParameterCode.RoomName])&&(this.name=e)},t.prototype._updateFromProps=function(e){if(e){this.maxPlayers=this.updateIfExists(this.maxPlayers,c.Constants.GameProperties.MaxPlayers,e),this.isVisible=this.updateIfExists(this.isVisible,c.Constants.GameProperties.IsVisible,e),this.isOpen=this.updateIfExists(this.isOpen,c.Constants.GameProperties.IsOpen,e),this.playerCount=this.updateIfExists(this.playerCount,c.Constants.GameProperties.PlayerCount,e),this.removed=this.updateIfExists(this.removed,c.Constants.GameProperties.Removed,e),this._propsListedInLobby=this.updateIfExists(this._propsListedInLobby,c.Constants.GameProperties.PropsListedInLobby,e),this.cleanupCacheOnLeave=this.updateIfExists(this.cleanupCacheOnLeave,c.Constants.GameProperties.CleanupCacheOnLeave,e),this.masterClientId=this.updateIfExists(this.masterClientId,c.Constants.GameProperties.MasterClientId,e),this.emptyRoomLiveTime=this.updateIfExists(this.emptyRoomLiveTime,c.Constants.GameProperties.EmptyRoomTtl,e),this.suspendedPlayerLiveTime=this.updateIfExists(this.suspendedPlayerLiveTime,c.Constants.GameProperties.PlayerTtl,e);var t,o={};for(t in e)parseInt(t).toString()!=t&&this._customProperties[t]!==e[t]&&(this._customProperties[t]=e[t],o[t]=e[t]);this.onPropertiesChange(o,!1)}},t.prototype._updateFromEvent=function(e){e&&(this.masterClientId=this.updateIfExists(this.masterClientId,c.Constants.ParameterCode.MasterClientId,e))},t.prototype.updateIfExists=function(e,t,o){return o.hasOwnProperty(t)?o[t]:e},t);function t(e){this.address=this.name="",this.maxPlayers=0,this.isOpen=this.isVisible=!0,this.suspendedPlayerLiveTime=this.emptyRoomLiveTime=this.playerCount=0,this.cleanupCacheOnLeave=this.removed=!1,this.masterClientId=0,this._customProperties={},this._propsListedInLobby=[],this.name=e}c.RoomInfo=i;var o,n=(__extends(s,o=i),s.prototype.setCustomProperty=function(e,t,o,r){void 0===o&&(o=!1),this._customProperties[e]=t;var n,s={};s[e]=t,null!=r&&((n={})[e]=r,n=n),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfRoom(s,o,n),this.onPropertiesChange(s,!0)},s.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var r,n={};for(r in e)this._customProperties[r]=e[r],n[r]=e[r];this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&this.loadBalancingClient._setPropertiesOfRoom(n,t,o),this.onPropertiesChange(n,!0)},s.prototype.setProp=function(e,t){var o;this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()&&((o={})[e]=t,this.loadBalancingClient._setPropertiesOfRoom(o,!1,void 0))},s.prototype.setIsVisible=function(e){this.isVisible!=e&&(this.isVisible=e,this.setProp(c.Constants.GameProperties.IsVisible,e))},s.prototype.setIsOpen=function(e){this.isOpen!=e&&(this.isOpen=e,this.setProp(c.Constants.GameProperties.IsOpen,e))},s.prototype.setMaxPlayers=function(e){this.maxPlayers!=e&&(this.maxPlayers=e,this.setProp(c.Constants.GameProperties.MaxPlayers,e))},s.prototype.setEmptyRoomLiveTime=function(e){this.emptyRoomLiveTime!=e&&(this.emptyRoomLiveTime=e,this.setProp(c.Constants.GameProperties.EmptyRoomTtl,e))},s.prototype.setSuspendedPlayerLiveTime=function(e){this.suspendedPlayerLiveTime!=e&&(this.suspendedPlayerLiveTime=e,this.setProp(c.Constants.GameProperties.PlayerTtl,e))},s.prototype.setPlugins=function(e){this.plugins=e},s.prototype.setPropsListedInLobby=function(e){this._propsListedInLobby=e},s.prototype._setLBC=function(e){this.loadBalancingClient=e},s);function s(e){return o.call(this,e)||this}c.Room=n;var a,p=(d.prototype.onStateChange=function(e){},d.prototype.onError=function(e,t){},d.prototype.onOperationResponse=function(e,t,o,r){},d.prototype.onEvent=function(e,t,o){},d.prototype.onRoomList=function(e){},d.prototype.onRoomListUpdate=function(e,t,o,r){},d.prototype.onMyRoomPropertiesChange=function(){},d.prototype.onActorPropertiesChange=function(e){},d.prototype.onJoinRoom=function(e){},d.prototype.onActorJoin=function(e){},d.prototype.onActorLeave=function(e,t){},d.prototype.onActorSuspend=function(e){},d.prototype.onFindFriendsResult=function(e,t,o){},d.prototype.onLobbyStats=function(e,t,o){},d.prototype.onAppStats=function(e,t,o){},d.prototype.onGetRegionsResult=function(e,t,o){},d.prototype.onWebRpcResult=function(e,t,o,r,n){},d.prototype.roomFactory=function(e){return new n(e)},d.prototype.actorFactory=function(e,t,o){return new r(e,t,o)},d.prototype.myActor=function(){return this._myActor},d.prototype.myRoom=function(){return this.currentRoom},d.prototype.myRoomActors=function(){return this.actors},d.prototype.myRoomActorCount=function(){return this.actorsArray.length},d.prototype.myRoomActorsArray=function(){return this.actorsArray},d.prototype.myRoomMasterActorNr=function(){return this.myRoom().masterClientId?this.myRoom().masterClientId:this.lowestActorId},d.prototype.lastRtt=function(){return this.gamePeer&&this.gamePeer.getLastRtt()},d.prototype.roomFactoryInternal=function(e){return void 0===e&&(e=""),(e=this.roomFactory(e))._setLBC(this),e},d.prototype.actorFactoryInternal=function(e,t,o){return void 0===e&&(e=""),void 0===t&&(t=-1),void 0===o&&(o=!1),(e=this.actorFactory(e,t,o))._setLBC(this),e},d.prototype.setNameServerAddress=function(e){this.nameServerAddress=e},d.prototype.getNameServerAddress=function(){return this.nameServerAddress},d.prototype.setMasterServerAddress=function(e){this.masterServerAddress=e},d.prototype.getMasterServerAddress=function(){return this.nameServerAddress},d.prototype.setUserId=function(e){this.userId=e},d.prototype.getUserId=function(){return this.userId},d.prototype.setCustomAuthentication=function(e,t,o){void 0===t&&(t=b.LoadBalancing.Constants.CustomAuthenticationType.Custom),this.userAuthType=t,this.userAuthParameters=e,this.userAuthData=o},d.prototype.connect=function(e){if("boolean"==typeof e&&(e=e?{keepMasterConnection:!0}:{keepMasterConnection:!1}),e=e||{},this.checkNextState(d.State.ConnectingToMasterserver,!0)){for(var t in this.changeState(d.State.ConnectingToMasterserver),this.logger.info("Connecting to Master",this.masterServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.masterPeer&&this.masterPeer.Destroy(),this.masterPeer=new g(this,this.connectionProtocol,this.masterServerAddress,""),this.initMasterPeer(this.masterPeer),this.masterPeer.connect(this.appId),!0}return!1},d.prototype.connectToNameServer=function(e){if(e=e||{},this.checkNextState(d.State.ConnectingToNameServer,!0)){for(var t in this.changeState(d.State.ConnectingToNameServer),this.logger.info("Connecting to NameServer",this.nameServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.nameServerPeer&&this.nameServerPeer.Destroy(),this.nameServerPeer=new l(this,this.connectionProtocol,this.nameServerAddress,""),this.initNameServerPeer(this.nameServerPeer),this.nameServerPeer.connect(this.appId),!0}return!1},d.prototype.fillCreateRoomOptions=function(e,t){var o={};if(void 0!==(t=t||{}).isVisible&&(o[c.Constants.GameProperties.IsVisible]=t.isVisible),void 0!==t.isOpen&&(o[c.Constants.GameProperties.IsOpen]=t.isOpen),void 0!==t.maxPlayers&&(o[c.Constants.GameProperties.MaxPlayers]=t.maxPlayers),void 0!==t.propsListedInLobby&&(o[c.Constants.GameProperties.PropsListedInLobby]=b.TypeExt.String(t.propsListedInLobby)),void 0!==t.customGameProperties)for(var r in t.customGameProperties)o[r]=t.customGameProperties[r];e.push(c.Constants.ParameterCode.GameProperties,o),e.push(c.Constants.ParameterCode.CleanupCacheOnLeave,!0),e.push(c.Constants.ParameterCode.Broadcast,!0),void 0!==t.emptyRoomLiveTime&&e.push(c.Constants.ParameterCode.EmptyRoomTTL,b.TypeExt.Int(t.emptyRoomLiveTime)),void 0!==t.suspendedPlayerLiveTime&&e.push(c.Constants.ParameterCode.PlayerTTL,b.TypeExt.Int(t.suspendedPlayerLiveTime)),void 0!==t.plugins&&e.push(c.Constants.ParameterCode.Plugins,t.plugins),e.push(c.Constants.ParameterCode.CheckUserOnJoin,!0),t.lobbyName&&(e.push(c.Constants.ParameterCode.LobbyName),e.push(t.lobbyName),null!=t.lobbyType&&(e.push(c.Constants.ParameterCode.LobbyType),e.push(t.lobbyType)))},d.prototype.createRoomFromMy=function(e,t){return this.currentRoom.name=e||"",t=this.copyCreateOptionsFromMyRoom(t),this.createRoomInternal(this.masterPeer,t)},d.prototype.copyCreateOptionsFromMyRoom=function(e){return(e=e||{}).isVisible=this.currentRoom.isVisible,e.isOpen=this.currentRoom.isOpen,e.maxPlayers=this.currentRoom.maxPlayers,e.customGameProperties=this.currentRoom._customProperties,e.propsListedInLobby=this.currentRoom._propsListedInLobby,e.emptyRoomLiveTime=this.currentRoom.emptyRoomLiveTime,e.suspendedPlayerLiveTime=this.currentRoom.suspendedPlayerLiveTime,e.plugins=this.currentRoom.plugins,e},d.prototype.createRoom=function(e,t){return this.currentRoom=this.roomFactoryInternal(e||""),this.createRoomInternal(this.masterPeer,t)},d.prototype.joinRoom=function(e,t,o){var r=[];return t&&(t.createIfNotExists&&(r.push(c.Constants.ParameterCode.JoinMode,d.JoinMode.CreateIfNotExists),this.fillCreateRoomOptions(r,o)),t.rejoin&&r.push(c.Constants.ParameterCode.JoinMode,d.JoinMode.RejoinOnly)),this.currentRoom=this.roomFactoryInternal(e),r.push(c.Constants.ParameterCode.RoomName,e),this.joinRoomOptions=t||{},this.createRoomOptions=o||{},this.logger.info("Join Room",e,t,o,"..."),this.masterPeer.sendOperation(c.Constants.OperationCode.JoinGame,r),!0},d.prototype.joinRandomRoom=function(e){var t=[];if(e){null!=e.matchingType&&e.matchingType!=c.Constants.MatchmakingMode.FillRoom&&(t.push(c.Constants.ParameterCode.MatchMakingType),t.push(e.matchingType));var o={},r=!1;if(null!=e.expectedCustomRoomProperties)for(var n in e.expectedCustomRoomProperties)o[n]=e.expectedCustomRoomProperties[n],r=!0;null!=e.expectedMaxPlayers&&0<e.expectedMaxPlayers&&(o[c.Constants.GameProperties.MaxPlayers]=e.expectedMaxPlayers,r=!0),r&&(t.push(c.Constants.ParameterCode.GameProperties),t.push(o)),e.lobbyName&&(t.push(c.Constants.ParameterCode.LobbyName),t.push(e.lobbyName),null!=e.lobbyType&&(t.push(c.Constants.ParameterCode.LobbyType),t.push(e.lobbyType))),e.sqlLobbyFilter&&(t.push(c.Constants.ParameterCode.Data),t.push(e.sqlLobbyFilter))}return this.logger.info("Join Random Room",e&&e.lobbyName,e&&e.lobbyType,"..."),this.masterPeer.sendOperation(c.Constants.OperationCode.JoinRandomGame,t),!0},d.prototype._setPropertiesOfRoom=function(e,t,o){var r=[];r.push(c.Constants.ParameterCode.Properties),r.push(e),r.push(c.Constants.ParameterCode.Broadcast),r.push(!0),t&&(r.push(c.Constants.ParameterCode.WebFlags),r.push(b.TypeExt.Byte(1))),o&&(r.push(c.Constants.ParameterCode.ExpectedValues),r.push(o)),this.gamePeer.sendOperation(c.Constants.OperationCode.SetProperties,r)},d.prototype._setPropertiesOfActor=function(e,t,o,r){var n=[];n.push(c.Constants.ParameterCode.ActorNr),n.push(e),n.push(c.Constants.ParameterCode.Properties),n.push(t),n.push(c.Constants.ParameterCode.Broadcast),n.push(!0),o&&(n.push(c.Constants.ParameterCode.WebFlags),n.push(b.TypeExt.Byte(1))),r&&(n.push(c.Constants.ParameterCode.ExpectedValues),n.push(r)),this.gamePeer.sendOperation(c.Constants.OperationCode.SetProperties,n)},d.prototype.disconnect=function(){this.nameServerPeer&&this.nameServerPeer.disconnect(),this._cleanupNameServerPeerData(),this.masterPeer&&this.masterPeer.disconnect(),this._cleanupMasterPeerData(),this.gamePeer&&this.gamePeer.disconnect(),this._cleanupGamePeerData(),this.changeState(d.State.Disconnected)},d.prototype.suspendRoom=function(e){var t;this.isJoinedToRoom()&&(this.gamePeer&&(t=[],e&&e.sendAuthCookie&&t.push(c.Constants.ParameterCode.WebFlags,b.TypeExt.Byte(2)),t.push(c.Constants.ParameterCode.IsInactive,!0),this.gamePeer.sendOperation(c.Constants.OperationCode.Leave,t),this.gamePeerWaitingForDisconnect=!0),this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(d.State.JoinedLobby):(this.changeState(d.State.Disconnected),this.connect(this.connectOptions)))},d.prototype.leaveRoom=function(e){var t;this.isJoinedToRoom()&&(this.gamePeer&&(t=[],e&&e.sendAuthCookie&&t.push(c.Constants.ParameterCode.WebFlags,b.TypeExt.Byte(2)),this.gamePeer.sendOperation(c.Constants.OperationCode.Leave,t),this.gamePeerWaitingForDisconnect=!0),this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(d.State.JoinedLobby):(this.changeState(d.State.Disconnected),this.connect(this.connectOptions)))},d.prototype.raiseEvent=function(e,t,o){this.isJoinedToRoom()&&this.gamePeer.raiseEvent(e,t,o)},d.prototype.changeGroups=function(e,t){this.isJoinedToRoom()&&(this.logger.debug("Group change:",e,t),this.gamePeer.changeGroups(e,t))},d.prototype.findFriends=function(e){if(this.isConnectedToMaster())if(e&&"object"==typeof e){this.findFriendsRequestList=[];for(var t=0;t<e.length;++t){if("string"!=typeof e[t])return this.logger.error("FindFriends request error:","Friend name is not a string",t),void this.onFindFriendsResult(-1,"Friend name is not a string "+t,{});this.findFriendsRequestList[t]=e[t]}this.logger.debug("Find friends:",e),this.masterPeer.findFriends(this.findFriendsRequestList)}else this.logger.error("FindFriends request error:","Parameter is not an array"),this.onFindFriendsResult(-1,"Parameter is not an array",{});else this.logger.error("FindFriends request error:","Not connected to Master"),this.onFindFriendsResult(d.PeerErrorCode.MasterError,"Not connected to Master",{})},d.prototype.requestLobbyStats=function(e){if(this.isConnectedToMaster()){if(this.lobbyStatsRequestList=[],e){if("object"!=typeof e)return void this.requestLobbyStatsErr("Parameter is not an array");for(var t=0;t<e.length;++t){var o=e[t];if("object"!=typeof o)return void this.requestLobbyStatsErr("Lobby id is not an array",t);var r=o[0];if(!r)return void this.requestLobbyStatsErr("Lobby name is empty",t);if(void 0===o[1])o=c.Constants.LobbyType.Default;else{if("number"!=typeof o[1])return void this.requestLobbyStatsErr("Lobby type is invalid",t);o=o[1]}this.lobbyStatsRequestList[t]=[r.toString(),o]}}this.masterPeer.requestLobbyStats(this.lobbyStatsRequestList)}else this.logger.error("LobbyState request error:","Not connected to Master"),this.onLobbyStats(d.PeerErrorCode.MasterError,"Not connected to Master",[])},d.prototype.requestLobbyStatsErr=function(e,t){void 0===t&&(t=""),this.logger.error("LobbyState request error:",e,t),this.onLobbyStats(-1,e+" "+t,[])},d.prototype.getRegions=function(){this.isConnectedToNameServer()?(this.logger.debug("GetRegions..."),this.nameServerPeer.getRegions(this.appId)):(this.logger.error("GetRegions request error:","Not connected to NameServer"),this.onGetRegionsResult(d.PeerErrorCode.NameServerError,"Not connected to NameServer",{}))},d.prototype.webRpc=function(e,t,o){this.isConnectedToMaster()?(this.logger.debug("WebRpc..."),this.masterPeer.webRpc(e,t,o)):this.isJoinedToRoom()?(this.logger.debug("WebRpc..."),this.gamePeer.webRpc(e,t,o)):(this.logger.error("WebRpc request error:","Connected to neither Master nor Game server"),this.onWebRpcResult(d.PeerErrorCode.MasterError,"Connected to neither Master nor Game server",e,0,{}))},d.prototype.connectToRegionMaster=function(e){return this.isConnectedToNameServer()?(this.logger.debug("Connecting to Region Master",e,"..."),this.nameServerPeer.opAuth(this.appId,this.appVersion,this.userAuthType,this.userAuthParameters,this.userAuthData,this.userId,e),!0):!!this.connectToNameServer({region:e})||(this.logger.error("Connecting to Region Master error:","Not connected to NameServer"),!1)},d.prototype.isConnectedToMaster=function(){return this.masterPeer&&this.masterPeer.isConnected()},d.prototype.isConnectedToNameServer=function(){return this.nameServerPeer&&this.nameServerPeer.isConnected()},d.prototype.isInLobby=function(){return this.state==d.State.JoinedLobby},d.prototype.isJoinedToRoom=function(){return this.state==d.State.Joined},d.prototype.isConnectedToGame=function(){return this.isJoinedToRoom()},d.prototype.availableRooms=function(){return this.roomInfos},d.prototype.setLogLevel=function(e){this.logger.setLevel(e),this.nameServerPeer&&this.nameServerPeer.setLogLevel(e),this.masterPeer&&this.masterPeer.setLogLevel(e),this.gamePeer&&this.gamePeer.setLogLevel(e)},d.prototype.addRoom=function(e){this.roomInfos.push(e),this.roomInfosDict[e.name]=e},d.prototype.clearRooms=function(){this.roomInfos=[],this.roomInfosDict={}},d.prototype.purgeRemovedRooms=function(){for(var e in this.roomInfos=this.roomInfos.filter(function(e){return!e.removed}),this.roomInfosDict)this.roomInfosDict[e].removed&&delete this.roomInfosDict[e]},d.prototype.addActor=function(e){this.actors[e.actorNr]=e,this.actorsArray.push(e),this.currentRoom.playerCount=this.actorsArray.length,(0==this.lowestActorId||this.lowestActorId>e.actorNr)&&(this.lowestActorId=e.actorNr)},d.prototype.removeActor=function(t){delete this.actors[t],this.actorsArray=this.actorsArray.filter(function(e){return e.actorNr!=t}),this.currentRoom.playerCount=this.actorsArray.length,this.lowestActorId==t&&(this.lowestActorId=0<this.actorsArray.length?this.actorsArray.reduce(function(e,t){return e.actorNr<t.actorNr?e:t}).actorNr:0)},d.prototype.clearActors=function(){this.actors={},this.actorsArray=[],this.lowestActorId=this.currentRoom.playerCount=0},d.prototype.changeState=function(e){this.logger.info("State:",d.StateToName(this.state),"->",d.StateToName(e)),this.state=e,this.onStateChange(e)},d.prototype.createRoomInternal=function(e,t){var o=[];this.currentRoom.name&&o.push(c.Constants.ParameterCode.RoomName,this.currentRoom.name),this.fillCreateRoomOptions(o,t),e===this.masterPeer&&(this.createRoomOptions=t),e===this.gamePeer&&(o.push(c.Constants.ParameterCode.PlayerProperties),o.push(this._myActor._getAllProperties())),(e==this.gamePeer?this.gamePeer:this.masterPeer)._logger.info("Create Room",t&&t.lobbyName,t&&t.lobbyType,"..."),e.sendOperation(c.Constants.OperationCode.CreateGame,o)},d.prototype.updateUserIdAndNickname=function(e,t){var o=e[c.Constants.ParameterCode.UserId];null!=o&&(this.setUserId(o),t.info("Setting userId sent by server:",o)),null!=(e=e[c.Constants.ParameterCode.Nickname])&&(this.myActor().setName(e),t.info("Setting nickname sent by server:",e))},d.prototype.initNameServerPeer=function(s){var i=this;s.setLogLevel(this.logger.getLevel()),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,function(){i.changeState(d.State.Error),i._onErrorInternal(d.PeerErrorCode.NameServerError,"NameServer peer error")}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){i.changeState(d.State.Error),i._onErrorInternal(d.PeerErrorCode.NameServerConnectFailed,"NameServer peer connect failed. "+i.nameServerAddress)}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){i.changeState(d.State.Error),i._onErrorInternal(d.PeerErrorCode.NameServerTimeout,"NameServer peer timeout")}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.connecting,function(){}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){s._logger.info("Connected"),i.changeState(d.State.ConnectedToNameServer),null!=i.connectOptions.region&&s.opAuth(i.appId,i.appVersion,i.userAuthType,i.userAuthParameters,i.userAuthData,i.userId,i.connectOptions.region)}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){s==i.nameServerPeer&&(i._cleanupNameServerPeerData(),s._logger.info("Disconnected"))}),s.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,function(){s._logger.info("Server closed connection"),i.changeState(d.State.Error),i._onErrorInternal(d.PeerErrorCode.NameServerConnectClosed,"NameServer server closed connection")}),s.addResponseListener(c.Constants.OperationCode.GetRegions,function(e){s._logger.debug("resp GetRegions",e);var t={};if(0==e.errCode){var o,r=e.vals[c.Constants.ParameterCode.Region],n=e.vals[c.Constants.ParameterCode.Address];for(o in r)t[r[o]]=n[o]}else s._logger.error("GetRegions request error.",e.errCode);i.onGetRegionsResult(e.errCode,e.errMsg,t)}),s.addResponseListener(c.Constants.OperationCode.Authenticate,function(e){s._logger.debug("resp Authenticate",e),0==e.errCode?(s._logger.info("Authenticated"),s.disconnect(),i.updateUserIdAndNickname(e.vals,s._logger),i.masterServerAddress=e.vals[c.Constants.ParameterCode.Address],s._logger.info("Connecting to Master server",i.masterServerAddress,"..."),i.connectOptions.userAuthSecret=e.vals[c.Constants.ParameterCode.Secret],i.connect(i.connectOptions)):(i.changeState(d.State.Error),i._onErrorInternal(d.PeerErrorCode.NameServerAuthenticationFailed,"NameServer authentication failed: "+e.errCode+" "+e.errMsg))})},d.prototype.initMasterPeer=function(a){var p=this;a.setLogLevel(this.logger.getLevel()),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterError,"Master peer error")}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterConnectFailed,"Master peer connect failed: "+p.masterServerAddress)}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterTimeout,"Master peer error timeout")}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connecting,function(){}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){a._logger.info("Connected");var e=[];p.connectOptions.userAuthSecret?(e.push(c.Constants.ParameterCode.Secret,p.connectOptions.userAuthSecret),a.sendOperation(c.Constants.OperationCode.Authenticate,e),a._logger.info("Authenticate with secret...")):(e.push(c.Constants.ParameterCode.ApplicationId),e.push(p.appId),e.push(c.Constants.ParameterCode.AppVersion),e.push(p.appVersion),p.userAuthType!=c.Constants.CustomAuthenticationType.None&&(e.push(c.Constants.ParameterCode.ClientAuthenticationType,b.TypeExt.Byte(p.userAuthType)),e.push(c.Constants.ParameterCode.ClientAuthenticationParams,p.userAuthParameters),p.userAuthData&&e.push(c.Constants.ParameterCode.ClientAuthenticationData,p.userAuthData)),p.userId&&e.push(c.Constants.ParameterCode.UserId,p.userId),p.connectOptions.lobbyStats&&e.push(c.Constants.ParameterCode.LobbyStats,!0),a.sendOperation(c.Constants.OperationCode.Authenticate,e),a._logger.info("Authenticate..."))}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){a==p.masterPeer&&(p._cleanupMasterPeerData(),a._logger.info("Disconnected"))}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,function(){a._logger.info("Server closed connection"),p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterConnectClosed,"Master server closed connection")}),a.addEventListener(c.Constants.EventCode.GameList,function(e){for(var t in e=e.vals[c.Constants.ParameterCode.GameList],p.clearRooms(),e){var o=new i(t);o._updateFromProps(e[t]),p.addRoom(o)}p.onRoomList(p.roomInfos),a._logger.debug("ev GameList",p.roomInfos,e)}),a.addEventListener(c.Constants.EventCode.GameListUpdate,function(e){var t,o=[],r=[],n=[];for(t in e=e.vals[c.Constants.ParameterCode.GameList]){var s=p.roomInfos.filter(function(e){return e.name==t});0<s.length?((s=s[0])._updateFromProps(e[t]),(s.removed?n:o).push(s)):((s=new i(t))._updateFromProps(e[t]),p.addRoom(s),r.push(s))}p.purgeRemovedRooms(),p.onRoomListUpdate(p.roomInfos,o,r,n),a._logger.debug("ev GameListUpdate:",p.roomInfos,"u:",o,"a:",r,"r:",n,e)}),a.addResponseListener(c.Constants.OperationCode.Authenticate,function(e){a._logger.debug("resp Authenticate",e),e.errCode?(p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterAuthenticationFailed,"Master authentication failed: "+e.errCode+" "+e.errMsg)):(a._logger.info("Authenticated"),p.updateUserIdAndNickname(e.vals,a._logger),null!=e.vals[c.Constants.ParameterCode.Secret]&&(p.connectOptions.userAuthSecret=e.vals[c.Constants.ParameterCode.Secret]),p.changeState(d.State.ConnectedToMaster),e=[],p.connectOptions.lobbyName&&(e.push(c.Constants.ParameterCode.LobbyName),e.push(p.connectOptions.lobbyName),null!=p.connectOptions.lobbyType&&(e.push(c.Constants.ParameterCode.LobbyType),e.push(p.connectOptions.lobbyType))),p.autoJoinLobby&&(a.sendOperation(c.Constants.OperationCode.JoinLobby,e),a._logger.info("Join Lobby",p.connectOptions.lobbyName,p.connectOptions.lobbyType,"...")))}),a.addResponseListener(c.Constants.OperationCode.JoinLobby,function(e){a._logger.debug("resp JoinLobby",e),e.errCode||(a._logger.info("Joined to Lobby"),p.changeState(d.State.JoinedLobby)),p._onOperationResponseInternal2(c.Constants.OperationCode.JoinLobby,e)}),a.addResponseListener(c.Constants.OperationCode.CreateGame,function(e){a._logger.debug("resp CreateGame",e),e.errCode||(p.currentRoom._updateFromMasterResponse(e.vals),a._logger.debug("Created/Joined "+p.currentRoom.name),p.connectToGameServer(c.Constants.OperationCode.CreateGame)),p._onOperationResponseInternal2(c.Constants.OperationCode.CreateGame,e)}),a.addResponseListener(c.Constants.OperationCode.JoinGame,function(e){a._logger.debug("resp JoinGame",e),e.errCode||(p.currentRoom._updateFromMasterResponse(e.vals),a._logger.debug("Joined "+p.currentRoom.name),p.connectToGameServer(c.Constants.OperationCode.JoinGame)),p._onOperationResponseInternal2(c.Constants.OperationCode.JoinGame,e)}),a.addResponseListener(c.Constants.OperationCode.JoinRandomGame,function(e){a._logger.debug("resp JoinRandomGame",e),e.errCode||(p.currentRoom._updateFromMasterResponse(e.vals),a._logger.debug("Joined "+p.currentRoom.name),p.connectToGameServer(c.Constants.OperationCode.JoinRandomGame)),p._onOperationResponseInternal2(c.Constants.OperationCode.JoinRandomGame,e)}),a.addResponseListener(c.Constants.OperationCode.FindFriends,function(e){a._logger.debug("resp FindFriends",e);var t={};if(e.errCode)a._logger.error("FindFriends request error:",e.errCode);else for(var o=e.vals[c.Constants.ParameterCode.FindFriendsResponseOnlineList]||{},r=e.vals[c.Constants.ParameterCode.FindFriendsResponseRoomIdList]||{},n=0;n<p.findFriendsRequestList.length;++n){var s=p.findFriendsRequestList[n];s&&(t[s]={online:o[n],roomId:r[n]})}p.onFindFriendsResult(e.errCode,e.errMsg,t)}),a.addResponseListener(c.Constants.OperationCode.LobbyStats,function(e){a._logger.debug("resp LobbyStats",e);var t=[];if(e.errCode)a._logger.error("LobbyStats request error:",e.errCode);else{var o=e.vals[c.Constants.ParameterCode.LobbyName],r=e.vals[c.Constants.ParameterCode.LobbyType]||{},n=e.vals[c.Constants.ParameterCode.PeerCount]||{},s=e.vals[c.Constants.ParameterCode.GameCount]||{};if(o)for(var i=0;i<o.length;++i)t[i]={lobbyName:o[i],lobbyType:r[i],peerCount:n[i],gameCount:s[i]};else for(i=0;i<p.lobbyStatsRequestList.length;++i)o=p.lobbyStatsRequestList[i],t[i]={lobbyName:o[0],lobbyType:o[1],peerCount:n[i],gameCount:s[i]}}p.onLobbyStats(e.errCode,e.errMsg,t)}),a.addEventListener(c.Constants.EventCode.LobbyStats,function(e){a._logger.debug("ev LobbyStats",e);var t=[],o=e.vals[c.Constants.ParameterCode.LobbyName],r=e.vals[c.Constants.ParameterCode.LobbyType]||{},n=e.vals[c.Constants.ParameterCode.PeerCount]||{};if(e=e.vals[c.Constants.ParameterCode.GameCount]||{},o)for(var s=0;s<o.length;++s)t[s]={lobbyName:o[s],lobbyType:r[s],peerCount:n[s],gameCount:e[s]};p.onLobbyStats(0,"",t)}),a.addEventListener(c.Constants.EventCode.AppStats,function(e){a._logger.debug("ev AppStats",e),p.onAppStats(0,"",{peerCount:e.vals[c.Constants.ParameterCode.PeerCount],masterPeerCount:e.vals[c.Constants.ParameterCode.MasterPeerCount],gameCount:e.vals[c.Constants.ParameterCode.GameCount]})}),a.addResponseListener(c.Constants.OperationCode.Rpc,a.webRpcHandler(this))},d.prototype.connectToGameServer=function(e){return this.connectOptions.keepMasterConnection||this.masterPeer.disconnect(),!!this.checkNextState(d.State.ConnectingToGameserver,!0)&&(this.logger.info("Connecting to Game",this.currentRoom.address),this.gamePeer&&this.gamePeer.Destroy(),this.gamePeer=new P(this,this.connectionProtocol,this.currentRoom.address,""),this.gamePeerWaitingForDisconnect=!1,this.initGamePeer(this.gamePeer,e),this.gamePeer.connect(this.appId),this.changeState(d.State.ConnectingToGameserver),!0)},d.prototype.initGamePeer=function(a,t){var p=this;a.setLogLevel(this.logger.getLevel()),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.error,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.GameError,"Game peer error")}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectFailed,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.GameConnectFailed,"Game peer connect failed: "+p.currentRoom.address)}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.timeout,function(){p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.GameTimeout,"Game peer timeout")}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connect,function(){a._logger.info("Connected");var e=[];e.push(c.Constants.ParameterCode.ApplicationId),e.push(p.appId),e.push(c.Constants.ParameterCode.AppVersion),e.push(p.appVersion),null!=p.connectOptions.userAuthSecret&&(e.push(c.Constants.ParameterCode.Secret),e.push(p.connectOptions.userAuthSecret)),p.userAuthType!=c.Constants.CustomAuthenticationType.None&&(e.push(c.Constants.ParameterCode.ClientAuthenticationType),e.push(b.TypeExt.Byte(p.userAuthType))),p.userId&&e.push(c.Constants.ParameterCode.UserId,p.userId),a.sendOperation(c.Constants.OperationCode.Authenticate,e),a._logger.info("Authenticate...")}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.disconnect,function(){a==p.gamePeer&&(p._cleanupGamePeerData(),a._logger.info("Disconnected"))}),a.addPeerStatusListener(b.PhotonPeer.StatusCodes.connectClosed,function(){a._logger.info("Server closed connection"),p.gamePeerWaitingForDisconnect||(p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.MasterConnectClosed,"Game server closed connection"))}),a.addResponseListener(c.Constants.OperationCode.Authenticate,function(e){a._logger.debug("resp Authenticate",e),e.errCode?(p.changeState(d.State.Error),p._onErrorInternal(d.PeerErrorCode.GameAuthenticationFailed,"Game authentication failed: "+e.errCode+" "+e.errMsg)):(a._logger.info("Authenticated"),a._logger.info("Connected"),t==c.Constants.OperationCode.CreateGame?p.createRoomInternal(a,p.createRoomOptions):((e=[]).push(c.Constants.ParameterCode.RoomName),e.push(p.currentRoom.name),e.push(c.Constants.ParameterCode.Broadcast),e.push(!0),e.push(c.Constants.ParameterCode.PlayerProperties),e.push(p._myActor._getAllProperties()),t==c.Constants.OperationCode.JoinGame&&(p.joinRoomOptions.createIfNotExists&&(e.push(c.Constants.ParameterCode.JoinMode,d.JoinMode.CreateIfNotExists),p.fillCreateRoomOptions(e,p.createRoomOptions)),p.joinRoomOptions.rejoin&&e.push(c.Constants.ParameterCode.JoinMode,d.JoinMode.RejoinOnly)),a.sendOperation(c.Constants.OperationCode.JoinGame,e)),p.changeState(d.State.ConnectedToGameserver))}),a.addResponseListener(c.Constants.OperationCode.CreateGame,function(e){a._logger.debug("resp CreateGame",e),e.errCode||(p._myActor._updateMyActorFromResponse(e.vals),a._logger.info("myActor: ",p._myActor),p.currentRoom._updateFromProps(e.vals[c.Constants.ParameterCode.GameProperties]),p.clearActors(),p.addActor(p._myActor),p.changeState(d.State.Joined),p.onJoinRoom(!0)),p._onOperationResponseInternal2(c.Constants.OperationCode.CreateGame,e)}),a.addResponseListener(c.Constants.OperationCode.JoinGame,function(e){if(a._logger.debug("resp JoinGame",e),!e.errCode){p._myActor._updateMyActorFromResponse(e.vals),a._logger.info("myActor: ",p._myActor),p.clearActors(),p.addActor(p._myActor);var t=e.vals[c.Constants.ParameterCode.ActorList],o=e.vals[c.Constants.ParameterCode.PlayerProperties];if(void 0!==t)for(var r=0;r<t.length;r++){var n,s,i=t[r];void 0!==o&&(n=o[i]),void 0!==n&&(s=n[c.Constants.ActorProperties.PlayerName]),i==p._myActor.actorNr?i=p._myActor:(i=p.actorFactoryInternal(s,i),p.addActor(i)),void 0!==n&&i._updateCustomProperties(n)}p.currentRoom._updateFromProps(e.vals[c.Constants.ParameterCode.GameProperties]),p.changeState(d.State.Joined),p.onJoinRoom(!1)}p._onOperationResponseInternal2(c.Constants.OperationCode.JoinGame,e)}),a.addResponseListener(c.Constants.OperationCode.SetProperties,function(e){a._logger.debug("resp SetProperties",e),p._onOperationResponseInternal2(c.Constants.OperationCode.SetProperties,e)}),a.addResponseListener(c.Constants.OperationCode.Leave,function(e){a._logger.debug("resp Leave",e),a.disconnect(),p._onOperationResponseInternal2(c.Constants.OperationCode.Leave,e)}),a.addResponseListener(c.Constants.OperationCode.Rpc,a.webRpcHandler(this)),a.addEventListener(c.Constants.EventCode.Join,function(e){var t;a._logger.debug("ev Join",e),r._getActorNrFromResponse(e.vals)===p._myActor.actorNr?(p._myActor._updateFromResponse(e.vals),p.onActorJoin(p._myActor)):((t=p.actorFactoryInternal())._updateFromResponse(e.vals),p.addActor(t),p.onActorJoin(t))}),a.addEventListener(c.Constants.EventCode.Leave,function(e){a._logger.debug("ev Leave",e),p.myRoom()._updateFromEvent(e.vals);var t,o=r._getActorNrFromResponse(e.vals);o&&p.actors[o]&&(t=p.actors[o],e.vals[c.Constants.ParameterCode.IsInactive]?(t._setSuspended(!0),p.onActorSuspend(t)):(p.removeActor(o),p.onActorLeave(t,!1)))}),a.addEventListener(c.Constants.EventCode.Disconnect,function(e){a._logger.debug("ev Disconnect",e),(e=r._getActorNrFromResponse(e.vals))&&p.actors[e]&&((e=p.actors[e])._setSuspended(!0),p.onActorSuspend(e))}),a.addEventListener(c.Constants.EventCode.PropertiesChanged,function(e){a._logger.debug("ev PropertiesChanged",e);var t=e.vals[c.Constants.ParameterCode.TargetActorNr];void 0!==t&&0<t?void 0!==p.actors[t]&&((t=p.actors[t])._updateCustomProperties(e.vals[c.Constants.ParameterCode.Properties]),p.onActorPropertiesChange(t)):(p.currentRoom._updateFromProps(e.vals[c.Constants.ParameterCode.Properties]),p.onMyRoomPropertiesChange())})},d.prototype._cleanupNameServerPeerData=function(){},d.prototype._cleanupMasterPeerData=function(){},d.prototype._cleanupGamePeerData=function(){for(var e in this.actors)this.onActorLeave(this.actors[e],!0);this.clearActors(),this.addActor(this._myActor)},d.prototype._onOperationResponseInternal2=function(e,t){t.errCode&&this.logger.warn("Operation",e,"error:",t.errMsg,"("+t.errCode+")"),this.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},d.prototype._onErrorInternal=function(e,t){this.logger.error("Error:",e,t),this.onError(e,t)},d.prototype.initValidNextState=function(){this.validNextState[d.State.Error]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer],this.validNextState[d.State.Uninitialized]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer],this.validNextState[d.State.ConnectedToNameServer]=[d.State.ConnectingToMasterserver],this.validNextState[d.State.Disconnected]=[d.State.ConnectingToMasterserver,d.State.ConnectingToNameServer],this.validNextState[d.State.ConnectedToMaster]=[d.State.JoinedLobby],this.validNextState[d.State.JoinedLobby]=[d.State.ConnectingToGameserver],this.validNextState[d.State.ConnectingToGameserver]=[d.State.ConnectedToGameserver],this.validNextState[d.State.ConnectedToGameserver]=[d.State.Joined]},d.prototype.checkNextState=function(e,t){void 0===t&&(t=!1);var o=this.validNextState[this.state];return(o=o&&0<=o.indexOf(e))||(t?this.logger.error("LoadBalancingPeer checkNextState fail: "+d.StateToName(this.state)+" -> "+d.StateToName(e)):this.logger.exception(501,"LoadBalancingPeer checkNextState fail: "+d.StateToName(this.state)+" -> "+d.StateToName(e))),o},d.StateToName=function(e){return Exitgames.Common.Util.getEnumKeyByValue(d.State,e)},d.JoinMode={Default:0,CreateIfNotExists:1,RejoinOnly:3},d.PeerErrorCode={Ok:0,MasterError:1001,MasterConnectFailed:1002,MasterConnectClosed:1003,MasterTimeout:1004,MasterEncryptionEstablishError:1005,MasterAuthenticationFailed:1101,GameError:2001,GameConnectFailed:2002,GameConnectClosed:2003,GameTimeout:2004,GameEncryptionEstablishError:2005,GameAuthenticationFailed:2101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:3005,NameServerAuthenticationFailed:3101},d.State={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToMasterserver:3,ConnectedToMaster:4,JoinedLobby:5,ConnectingToGameserver:6,ConnectedToGameserver:7,Joined:8,Disconnected:10},d);function d(e,t,o){if(this.appId=t,this.appVersion=o,this.autoJoinLobby=!0,this.connectOptions={},this.createRoomOptions={},this.joinRoomOptions={},this.roomInfos=[],this.roomInfosDict={},this.actors={},this.actorsArray=[],this.lowestActorId=0,this.userAuthType=c.Constants.CustomAuthenticationType.None,this.userAuthData=this.userAuthParameters="",this.lobbyStatsRequestList=[],this.state=d.State.Uninitialized,this.logger=new Exitgames.Common.Logger("Client:"),this.validNextState={},"number"==typeof e)switch(this.connectionProtocol=e,e){case b.ConnectionProtocol.Ws:this.masterServerAddress="ws://app-eu.exitgamescloud.com:9090",this.nameServerAddress="ws://ns.exitgames.com:9093";break;case b.ConnectionProtocol.Wss:this.masterServerAddress="wss://app-eu.exitgamescloud.com:19090",this.nameServerAddress="wss://ns.exitgames.com:19093";break;default:this.nameServerAddress=this.masterServerAddress="wrong_protocol_error",this.logger.error("Wrong protocol: ",e)}else"string"==typeof e?(this.connectionProtocol=b.ConnectionProtocol.Ws,this.nameServerAddress=this.masterServerAddress=e):(this.connectionProtocol=b.ConnectionProtocol.Ws,this.nameServerAddress=this.masterServerAddress="wrong_protocol_type_error",this.logger.error("Wrong protocol type: ",typeof e));this.initValidNextState(),this.currentRoom=this.roomFactoryInternal(""),this._myActor=this.actorFactoryInternal("",-1,!0),this.addActor(this._myActor)}function u(){return null!==a&&a.apply(this,arguments)||this}c.LoadBalancingClient=p,a=b.PhotonPeer,__extends(u,a),u.prototype.webRpc=function(e,t,o){var r=[];r.push(c.Constants.ParameterCode.UriPath,e),r.push(c.Constants.ParameterCode.RpcCallParams,t),o&&o.sendAuthCookie&&r.push(c.Constants.ParameterCode.WebFlags,b.TypeExt.Byte(2)),this.sendOperation(c.Constants.OperationCode.Rpc,r)},u.prototype.webRpcHandler=function(n){var s=this;return function(e){var t,o,r;s._logger.debug("resp Rpc",e),0==e.errCode?(t=e.vals[c.Constants.ParameterCode.UriPath],o=e.vals[c.Constants.ParameterCode.RpcCallRetData],r=e.vals[c.Constants.ParameterCode.RpcCallRetCode]):s._logger.error("WebRpc request error:",e.errCode),n.onWebRpcResult(e.errCode,e.errMsg,t,r,o)}},p=u,c.LbcPeer=p;var h,l=(__extends(m,h=p),m.prototype.onUnhandledEvent=function(e,t){this.client.onEvent(e,t.vals[c.Constants.ParameterCode.CustomEventContent],t.vals[c.Constants.ParameterCode.ActorNr])},m.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},m.prototype.getRegions=function(e){var t=[];t.push(c.Constants.ParameterCode.ApplicationId,e),this.sendOperation(c.Constants.OperationCode.GetRegions,t,!0,0)},m.prototype.opAuth=function(e,t,o,r,n,s,i){var a=[];a.push(c.Constants.ParameterCode.ApplicationId,e),a.push(c.Constants.ParameterCode.AppVersion,t),o!=c.Constants.CustomAuthenticationType.None&&(a.push(c.Constants.ParameterCode.ClientAuthenticationType,b.TypeExt.Byte(o)),a.push(c.Constants.ParameterCode.ClientAuthenticationParams,r),n&&a.push(c.Constants.ParameterCode.ClientAuthenticationData,n)),s&&a.push(c.Constants.ParameterCode.UserId,s),a.push(c.Constants.ParameterCode.Region,i),this.sendOperation(c.Constants.OperationCode.Authenticate,a,!0,0),this._logger.info("Authenticate...")},m);function m(e,t,o,r){return(t=h.call(this,t,o,r,e.logger.getPrefix()+" NameServer")||this).client=e,t}c.NameServerPeer=l;var C,g=(__extends(y,C=p),y.prototype.onUnhandledEvent=function(e,t){this.client.onEvent(e,t.vals[c.Constants.ParameterCode.CustomEventContent],t.vals[c.Constants.ParameterCode.ActorNr])},y.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},y.prototype.findFriends=function(e){var t=[];t.push(c.Constants.ParameterCode.FindFriendsRequestList),t.push(e),this.sendOperation(c.Constants.OperationCode.FindFriends,t)},y.prototype.requestLobbyStats=function(e){var t=[];if(e&&0<e.length){for(var o=[],r=[],n=0;n<e.length;++n)o[n]=e[n][0],r[n]=e[n][1];t.push(c.Constants.ParameterCode.LobbyName),t.push(o),t.push(c.Constants.ParameterCode.LobbyType),t.push(r)}this.sendOperation(c.Constants.OperationCode.LobbyStats,t)},y);function y(e,t,o,r){return(t=C.call(this,t,o,r,e.logger.getPrefix()+" Master")||this).client=e,t}c.MasterPeer=g;var v,P=(__extends(f,v=p),f.prototype.onUnhandledEvent=function(e,t){this.client.onEvent(e,t.vals[c.Constants.ParameterCode.CustomEventContent],t.vals[c.Constants.ParameterCode.ActorNr])},f.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},f.prototype.raiseEvent=function(e,t,o){if(!this.client.isJoinedToRoom())throw Error("raiseEvent - Not joined!");this._logger.debug("raiseEvent",e,t,o),e=[c.Constants.ParameterCode.Code,b.TypeExt.Byte(e),c.Constants.ParameterCode.Data,t],o&&(null!=o.receivers&&o.receivers!==c.Constants.ReceiverGroup.Others&&(e.push(c.Constants.ParameterCode.ReceiverGroup),e.push(b.TypeExt.Byte(o.receivers))),null!=o.cache&&o.cache!==c.Constants.EventCaching.DoNotCache&&(e.push(c.Constants.ParameterCode.Cache),e.push(b.TypeExt.Byte(o.cache))),null!=o.interestGroup&&(this.checkGroupNumber(o.interestGroup)?(e.push(c.Constants.ParameterCode.Group),e.push(b.TypeExt.Byte(o.interestGroup))):this._logger.exception(502,"raiseEvent - Group not a number: "+o.interestGroup)),null!=o.targetActors&&(e.push(c.Constants.ParameterCode.ActorList),e.push(o.targetActors)),o.webForward&&(e.push(c.Constants.ParameterCode.WebFlags),e.push(b.TypeExt.Byte(1)))),this.sendOperation(c.Constants.OperationCode.RaiseEvent,e)},f.prototype.changeGroups=function(e,t){var o=[];null!=e&&null!=e&&(this.checkGroupArray(e,"groupsToRemove"),o.push(c.Constants.ParameterCode.Remove),o.push(b.TypeExt.Byte(e))),null!=t&&null!=t&&(this.checkGroupArray(t,"groupsToAdd"),o.push(c.Constants.ParameterCode.Add),o.push(b.TypeExt.Byte(t))),this.sendOperation(c.Constants.OperationCode.ChangeGroups,o)},f.prototype.checkGroupNumber=function(e){return!("number"!=typeof e||isNaN(e)||1/0===e||-1/0===e)},f.prototype.checkGroupArray=function(e,t){if(Exitgames.Common.Util.isArray(e))for(var o=0;o<e.length;++o){var r=e[o];this.checkGroupNumber(r)||this._logger.exception(503,"changeGroups - "+t+" ("+e+") not an array of numbers: element "+o+" = "+r)}else this._logger.exception(504,"changeGroups - groupsToRemove not an array: "+e)},f);function f(e,t,o,r){return(t=v.call(this,t,o,r,e.logger.getPrefix()+" Game")||this).client=e,t}c.GamePeer=P}(b.LoadBalancing||(b.LoadBalancing={}))}(Photon=Photon||{}),function(e){(e=(e=e.Lite||(e.Lite={})).Constants||(e.Constants={})).LiteOpKey={ActorList:252,ActorNr:254,ActorProperties:249,Add:238,Broadcast:250,Cache:247,Code:244,Data:245,GameId:255,GameProperties:248,Group:240,Properties:251,ReceiverGroup:246,Remove:239,TargetActorNr:253,EmptyRoomLiveTime:236},e.LiteEventCode={Join:255,Leave:254,PropertiesChanged:253},e.LiteOpCode={ChangeGroups:248,GetProperties:251,Join:255,Leave:254,RaiseEvent:253,SetProperties:252}}(Photon=Photon||{}),function(e){var t=(t=e.LoadBalancing||(e.LoadBalancing={})).Constants||(t.Constants={}),o=e.Lite.Constants.LiteOpKey,r=e.Lite.Constants.LiteOpCode;e=e.Lite.Constants.LiteEventCode,t.ErrorCode={Ok:0,OperationNotAllowedInCurrentState:-3,InvalidOperationCode:-2,InternalServerError:-1,InvalidAuthentication:32767,GameIdAlreadyExists:32766,GameFull:32765,GameClosed:32764,NoRandomMatchFound:32760,GameDoesNotExist:32758,MaxCcuReached:32757,InvalidRegion:32756,CustomAuthenticationFailed:32755,AuthenticationTicketExpired:32753,PluginReportedError:32752,PluginMismatch:32751,JoinFailedPeerAlreadyJoined:32750,JoinFailedFoundInactiveJoiner:32749,JoinFailedWithRejoinerNotFound:32748,JoinFailedFoundExcludedUserId:32747,JoinFailedFoundActiveJoiner:32746,HttpLimitReached:32745,ExternalHttpCallFailed:32744,SlotError:32742,InvalidEncryptionParameters:32741},t.ActorProperties={PlayerName:255},t.GameProperties={MaxPlayers:255,IsVisible:254,IsOpen:253,PlayerCount:252,Removed:251,PropsListedInLobby:250,CleanupCacheOnLeave:249,MasterClientId:248,PlayerTtl:246,EmptyRoomTtl:245},t.EventCode={GameList:230,GameListUpdate:229,QueueState:228,AppStats:226,AzureNodeInfo:210,Join:e.Join,Leave:e.Leave,PropertiesChanged:e.PropertiesChanged,Disconnect:252,LobbyStats:224},t.ParameterCode={Address:230,PeerCount:229,GameCount:228,MasterPeerCount:227,UserId:225,ApplicationId:224,Position:223,MatchMakingType:223,GameList:222,Secret:221,AppVersion:220,AzureNodeInfo:210,AzureLocalNodeId:209,AzureMasterNodeId:208,RoomName:o.GameId,Broadcast:o.Broadcast,ActorList:o.ActorList,ActorNr:o.ActorNr,PlayerProperties:o.ActorProperties,CustomEventContent:o.Data,Data:o.Data,Code:o.Code,GameProperties:o.GameProperties,Properties:o.Properties,TargetActorNr:o.TargetActorNr,ReceiverGroup:o.ReceiverGroup,Cache:o.Cache,CleanupCacheOnLeave:241,Group:o.Group,Remove:o.Remove,Add:o.Add,EmptyRoomTTL:o.EmptyRoomLiveTime,PlayerTTL:235,Plugins:204,ClientAuthenticationType:217,ClientAuthenticationParams:216,ClientAuthenticationData:214,JoinMode:215,MasterClientId:203,FindFriendsRequestList:1,FindFriendsResponseOnlineList:1,FindFriendsResponseRoomIdList:2,LobbyName:213,LobbyType:212,LobbyStats:211,Region:210,IsInactive:233,CheckUserOnJoin:232,ExpectedValues:231,UriPath:209,RpcCallParams:208,RpcCallRetCode:207,RpcCallRetMessage:206,RpcCallRetData:208,WebFlags:234,Nickname:202},t.OperationCode={Authenticate:230,JoinLobby:229,LeaveLobby:228,CreateGame:227,JoinGame:226,JoinRandomGame:225,Leave:r.Leave,RaiseEvent:r.RaiseEvent,SetProperties:r.SetProperties,GetProperties:r.GetProperties,ChangeGroups:r.ChangeGroups,FindFriends:222,LobbyStats:221,GetRegions:220,Rpc:219},t.MatchmakingMode={FillRoom:0,SerialMatching:1,RandomMatching:2},t.EventCaching={DoNotCache:0,MergeCache:1,ReplaceCache:2,RemoveCache:3,AddToRoomCache:4,AddToRoomCacheGlobal:5,RemoveFromRoomCache:6,RemoveFromRoomCacheForActorsLeft:7},t.ReceiverGroup={Others:0,All:1,MasterClient:2},t.CustomAuthenticationType={Custom:0,Steam:1,Facebook:2,None:255},t.LobbyType={Default:0,SqlLobby:2}}(Photon=Photon||{}),function(e){var t;e=e.Chat||(e.Chat={}),(t=e.Constants||(e.Constants={})).ParameterCode={Channels:0,Channel:1,Messages:2,Message:3,Senders:4,Sender:5,ChannelUserCount:6,UserId:225,MsgId:8,MsgIds:9,SubscribeResults:15,Status:10,Friends:11,SkipMessage:12,HistoryLength:14,WebFlags:21},t.OperationCode={Subscribe:0,Unsubscribe:1,Publish:2,SendPrivate:3,ChannelHistory:4,UpdateStatus:5,AddFriendds:6,RemoveFriends:7},t.EventCode={ChatMessages:0,Users:1,PrivateMessage:2,FriendsList:3,StatusUpdate:4,Subscribe:5,Unsubscribe:6},t.UserStatus={Offline:0,Invisible:1,Online:2,Away:3,Dnd:4,Lfg:5,Playing:6},t.UserStatusToName=function(e){return Exitgames.Common.Util.getEnumKeyByValue(t.UserStatus,e)}}(Photon=Photon||{}),function(i){!function(a){var p=(e.prototype.getSender=function(){return this.sender},e.prototype.getContent=function(){return this.content},e);function e(e,t){this.sender=e,this.content=t}a.Message=p;var r=(t.prototype.getName=function(){return this.name},t.prototype.isPrivate=function(){return this.isPrivat},t.prototype.getMessages=function(){return this.messages},t.prototype.getLastId=function(){return this.lastId},t.prototype.clearMessages=function(){this.messages.splice(0)},t.prototype.addMessages=function(e,t){var o,r,n=[];for(o in e)parseInt(o)<t.length&&(r=new p(e[o],t[o]),this.messages.push(r),n.push(r));return n},t);function t(e,t){this.name=e,this.isPrivat=t,this.messages=[]}a.Channel=r;var n,o=(n=i.LoadBalancing.LoadBalancingClient,__extends(s,n),s.prototype.onStateChange=function(e){},s.prototype.onError=function(e,t){},s.prototype.onSubscribeResult=function(e){},s.prototype.onUnsubscribeResult=function(e){},s.prototype.onChatMessages=function(e,t){},s.prototype.onPrivateMessage=function(e,t){},s.prototype.onUserStatusUpdate=function(e,t,o,r){},s.prototype.connectToRegionFrontEnd=function(e){return this.connectToRegionMaster(e)},s.prototype.isConnectedToFrontEnd=function(){return this.state==s.ChatState.ConnectedToFrontEnd},s.prototype.subscribe=function(e,t){if("number"==typeof t&&(t={historyLength:t}),this.isConnectedToFrontEnd()){this.logger.debug("Subscribe channels:",e);var o=[];return o.push(a.Constants.ParameterCode.Channels,i.TypeExt.String(e)),t&&(t.historyLength&&o.push(a.Constants.ParameterCode.HistoryLength,i.TypeExt.Int(t.historyLength)),t.lastIds&&(o.push(a.Constants.ParameterCode.MsgIds,i.TypeExt.Int(t.lastIds)),void 0===t.historyLength&&o.push(a.Constants.ParameterCode.HistoryLength,i.TypeExt.Int(-1)))),this.masterPeer.sendOperation(a.Constants.OperationCode.Subscribe,o),!0}return this.logger.error("subscribe request error:","Not connected to Front End"),!1},s.prototype.unsubscribe=function(e){if(this.isConnectedToFrontEnd()){this.logger.debug("Unsubscribe channels:",e);var t=[];return t.push(a.Constants.ParameterCode.Channels,i.TypeExt.String(e)),this.masterPeer.sendOperation(a.Constants.OperationCode.Unsubscribe,t),!0}return this.logger.error("unsubscribe request error:","Not connected to Front End"),!1},s.prototype.publishMessage=function(e,t,o){if(this.isConnectedToFrontEnd()){var r=[];return r.push(a.Constants.ParameterCode.Channel,e),r.push(a.Constants.ParameterCode.Message,t),o&&o.webForward&&(r.push(a.Constants.ParameterCode.WebFlags),r.push(i.TypeExt.Byte(1))),this.masterPeer.sendOperation(a.Constants.OperationCode.Publish,r),!0}return this.logger.error("publishMessage request error:","Not connected to Front End"),!1},s.prototype.sendPrivateMessage=function(e,t,o){if(this.isConnectedToFrontEnd()){var r=[];return r.push(a.Constants.ParameterCode.UserId,e),r.push(a.Constants.ParameterCode.Message,t),o&&o.webForward&&(r.push(a.Constants.ParameterCode.WebFlags),r.push(i.TypeExt.Byte(1))),this.masterPeer.sendOperation(a.Constants.OperationCode.SendPrivate,r),!0}return this.logger.error("sendPrivateMessage request error:","Not connected to Front End"),!1},s.prototype.setUserStatus=function(e,t,o){if(void 0===t&&(t=null),void 0===o&&(o=!1),this.isConnectedToFrontEnd()){var r=[];return r.push(a.Constants.ParameterCode.Status,i.TypeExt.Int(e)),o?r.push(a.Constants.ParameterCode.SkipMessage,!0):r.push(a.Constants.ParameterCode.Message,t),this.masterPeer.sendOperation(a.Constants.OperationCode.UpdateStatus,r),!0}return this.logger.error("setUserStatus request error:","Not connected to Front End"),!1},s.prototype.addFriends=function(e){if(this.isConnectedToFrontEnd()){var t=[];return t.push(a.Constants.ParameterCode.Friends,i.TypeExt.String(e)),this.masterPeer.sendOperation(a.Constants.OperationCode.AddFriendds,t),!0}return this.logger.error("addFriends request error:","Not connected to Front End"),!1},s.prototype.removeFriends=function(e){if(this.isConnectedToFrontEnd()){var t=[];return t.push(a.Constants.ParameterCode.Friends,i.TypeExt.String(e)),this.masterPeer.sendOperation(a.Constants.OperationCode.RemoveFriends,t),!0}return this.logger.error("removeFriends request error:","Not connected to Front End"),!1},s.prototype.getPublicChannels=function(){return this.publicChannels},s.prototype.getPrivateChannels=function(){return this.privateChannels},s.prototype.getOrAddChannel=function(e,t,o){return null==e[t]&&(e[t]=new r(t,o)),e[t]},s.prototype.initMasterPeer=function(s){var i=this;n.prototype.initMasterPeer.call(this,s),s.addEventListener(a.Constants.EventCode.ChatMessages,function(e){var t=e.vals[a.Constants.ParameterCode.Senders],o=e.vals[a.Constants.ParameterCode.Messages],r=e.vals[a.Constants.ParameterCode.Channel],n=i.publicChannels[r];n?(t=n.addMessages(t,o),n.lastId=e.vals[a.Constants.ParameterCode.MsgId],i.onChatMessages(r,t)):s._logger.warn("ev ChatMessages: Got message from unsubscribed channel ",r)}),s.addEventListener(a.Constants.EventCode.PrivateMessage,function(e){var t=e.vals[a.Constants.ParameterCode.Sender],o=e.vals[a.Constants.ParameterCode.Message],r=e.vals[a.Constants.ParameterCode.UserId],r=i.getUserId()==t?r:t;i.getOrAddChannel(i.privateChannels,r,!0).lastId=e.vals[a.Constants.ParameterCode.MsgId],i.onPrivateMessage(r,new p(t,o))}),s.addEventListener(a.Constants.EventCode.StatusUpdate,function(e){var t=e.vals[a.Constants.ParameterCode.Message];i.onUserStatusUpdate(e.vals[a.Constants.ParameterCode.Sender],e.vals[a.Constants.ParameterCode.Status],void 0!==t,t)}),s.addEventListener(a.Constants.EventCode.Subscribe,function(e){s._logger.debug("ev Subscribe",e);var t,o={},r=e.vals[a.Constants.ParameterCode.Channels]||[];for(t in e=e.vals[a.Constants.ParameterCode.SubscribeResults]||[],r){var n=r[t];o[n]=!1,t<e.length&&e[t]&&(i.getOrAddChannel(i.publicChannels,n,!1),o[n]=!0)}i.onSubscribeResult(o)}),s.addEventListener(a.Constants.EventCode.Unsubscribe,function(e){s._logger.debug("ev Unsubscribe",e);var t,o={};for(t in e=e.vals[a.Constants.ParameterCode.Channels]||[]){var r=e[t];delete i.publicChannels[r],o[r]=!0}i.onUnsubscribeResult(o)})},s.StateToName=function(e){var t=Exitgames.Common.Util.getEnumKeyByValue(s.ChatState,e);return void 0===t?Exitgames.Common.Util.getEnumKeyByValue(s.State,e):t},s.ChatPeerErrorCode={Ok:0,FrontEndError:1001,FrontEndConnectFailed:1002,FrontEndConnectClosed:1003,FrontEndTimeout:1004,FrontEndEncryptionEstablishError:1005,FrontEndAuthenticationFailed:1101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:300,NameServerAuthenticationFailed:3101},s.ChatState={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToFrontEnd:3,ConnectedToFrontEnd:4,Disconnected:10},s);function s(e,t,o){return(e=n.call(this,e,t,o)||this).publicChannels={},e.privateChannels={},e.subscribeRequests=[],e.unsubscribeRequests=[],e.autoJoinLobby=!1,e}a.ChatClient=o}(i.Chat||(i.Chat={}))}(Photon=Photon||{});